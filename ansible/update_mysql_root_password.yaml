---
- name: Set MySQL root password
  hosts: ubuntu_server
  become: yes
  tasks:
    - name: Ensure MySQL is running
      service:
        name: mysql
        state: started
    - name: Install Python MySQL library
      apt:
        name: python3-pymysql
        state: present
    - name: Create a ~/.my.cnf file for root user
      copy:
        dest: /root/.my.cnf
        content: |
          [client]
          user = root
          socket = /var/run/mysqld/mysqld.sock
    - name: Create MySQL user andy
      mysql_user:
        name: andy
        host: localhost
        password: "andy"
        priv: "*.*:ALL,GRANT"
        state: present
    - name: Remove ~/.my.cnf file for security reasons
      file:
        path: /root/.my.cnf
        state: absent
